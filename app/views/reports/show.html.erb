<div class="container-fluid">
  <div class="container">
    <h2><%= @report.title %>: <%= @report.description %></h2>
    <p>Find me in app/views/reports/show.html.erb</p>
  </div>
</div>
<div class="container dev-test">
  <div class="col-md-12">
    <div class="col-md-5">
      <h3>Report Period Summary</h3>
      <h4>Total Spent During this Period: <%= number_to_currency(@report.receipts.sum(:total)) %></h4>
      <h4>Number of Transactions: <%= @report.receipts.count %></h4>
      <p>
        Download:
        <%= link_to "CSV", report_receipts_path(@report, format: "csv") %> |
        <%= link_to "Excel", report_receipts_path(@report, format: "xls") %>
      </p>
    </div>
    <div id="map-container" class="col-md-7">
      <div id="map" style='height: 400px; width: 100%;' class="col-md-7"></div>
    </div>
  </div>
  <div class="col-md-12">
    <%= link_to "Add New Receipt", "javascript:void(0)", id: "new-receipt", class: "btn btn-primary" %>
    <%= render partial: "receipts/new", :locals => { :receipt => @receipt } %>
  </div>

  <div class="receipt-loop-container col-md-12">
  <% @report.receipts.each do |receipt| %>
    <div id="<%= dom_id(receipt) %>" class="receipt-box dev-test">
      <div class="absolute-center">
      <h5><%= receipt.business_name %></h5>
        <%= link_to image_tag(receipt.image_url(:thumb)), "#", data: { toggle: "modal", target: "#myModal_#{receipt.id}"}, class: 'disabled-link' %>
      </div>
    </div>

    <div class="modal fade" id="myModal_<%= receipt.id %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <a class="close btn btn-light btn-xs pull-right toggle" data-dismiss="modal" aria-label="Close"><i aria-hidden="true" class="fa fa-times fa"></i></a>
            <h4 class="modal-title" id="myModalLabel">Receipt from <%= receipt.business_name %> on <%= standard_date(receipt.created_at) %></h4>
          </div>
          <div class="modal-body container-fluid dev-test">
            <center>
              <div class="modal-columns">
                <%= image_tag(receipt.image_url(:fitted)) if receipt.image? %></p> 
              </div>
              <div class="modal-columns">
                <p><%#= render "receipts/edit", receipt: receipt %></p>
                <p><%= render partial: "receipts/edit", :locals => { :receipt => receipt } %></p>
              </div>
            </center>
          </div> <!-- modal-dialog -->
        </div> <!-- modal-content -->
      </div> <!-- modal-dialog -->
    </div> <!-- modal and id="myModal_<%= receipt.id %>"-->
  <% end %> <!-- do loop -->
  </div> <!-- receipt-loop-container -->
</div> <!-- container -->

<script>
  $(document).ready(function(){
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
      markers = handler.addMarkers(<%= raw generate_markers(@locations) %>);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
    });
  });
</script>